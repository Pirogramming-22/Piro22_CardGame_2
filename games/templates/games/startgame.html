{% extends 'base.html' %}

{% block head %}
<style>
.container{
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
input[type="radio"]{
    display: none;
}

label.card{
    display: inline-flex;
    justify-content: center;
    align-items: center;
    background-color: white;
    width: 30px;
    height: 50px;
    cursor: pointer;
    padding: 5px;
    border-radius: 3px;
    transition: transform 0.2s ease;
}

.card:hover {
    background-color: #ddd;
    transform: scale(1.1);
}

.card-radio:checked + .card {
    background-color: #4CAF50; 
    color: white;
    transition: all 0.2s ease;
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <form action="{% url 'games:history_list'%}" method="post" enctype="multipart/form-data">
    {% csrf_token %}
        <div id="startgame-title">카드를 선택하세요! ♣️</div>

        <div id="choices-container">
            {% for num in numbers %}
                <input type="radio" name="card" id="card{{ num }}" value="{{ num }}" class="card-radio">
                <label for="card{{ num }}" class="card">{{ num }}</label>
            {% endfor %}
        </div>

        {% if error %}
            <div id="error-message">
                {{ error }}
            </div>
        {% endif %}

        <hr>

        <div id="choose_Defender">
            <label for="defending_player">Defender :</label>
            <select name="defending_player" id="defending_player">
                <option value="" disabled selected>====</option>
                {% for user in users %}
                    <option value="{{ user.id }}">{{ user.name }}</option>
                {% endfor %}
            </select>    
        </div>

        <div id="button-container">
            <button type="submit" id="attackBtn">ATTACK</button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    const radioButtons = document.querySelectorAll('.card-radio');
    const errorMessage = document.getElementById('error-message');
    const attackBtn = document.getElementById('attackBtn');

    // 카드 선택 시 경고 메시지 제거
    radioButtons.forEach(radio => {
        radio.addEventListener('change', () => {
            if (errorMessage) {
                errorMessage.style.display = 'none';  
            }
        });
    });

    attackBtn.addEventListener('click', (e) => {
        const selectedCard = document.querySelector('input[name="card"]:checked');
        const defenderPlayer = document.getElementById('defending_player').value;
        
        if (!selectedCard || !defenderPlayer) {
            e.preventDefault(); 
            if (!errorMessage) {
                const errorDiv = document.createElement('div');
                errorDiv.id = 'error-message';
                errorDiv.textContent = '⚠️ 카드를 선택해주세요!';
                document.querySelector('.container').insertBefore(errorDiv, document.getElementById('choose_Defender'));
            }
        }
    });

    radioButtons.forEach(radio => {
        radio.addEventListener('change', (e) => {
            const selectedCard = e.target.value;
        });
    });
</script>
{% endblock %}
